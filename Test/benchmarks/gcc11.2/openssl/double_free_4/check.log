In file included from ./benchmarks/openssl/double_free_4/openssl_df_4.c:9:
./benchmarks/openssl/double_free_4/openssl_df_4.c: In function ‘load_record’:
./benchmarks/openssl/double_free_4/../openssl.h:10:34: warning: implicit declaration of function ‘strdup’ [-Wimplicit-function-declaration]
   10 | #define OPENSSL_hexstr2buf(a, b) strdup(a)
      |                                  ^~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:271:12: note: in expansion of macro ‘OPENSSL_hexstr2buf’
  271 |     *key = OPENSSL_hexstr2buf(refdata[recnum].key, NULL);       /* custom allocation site */
      |            ^~~~~~~~~~~~~~~~~~
./benchmarks/openssl/double_free_4/../openssl.h:10:34: warning: incompatible implicit declaration of built-in function ‘strdup’ [-Wbuiltin-declaration-mismatch]
   10 | #define OPENSSL_hexstr2buf(a, b) strdup(a)
      |                                  ^~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:271:12: note: in expansion of macro ‘OPENSSL_hexstr2buf’
  271 |     *key = OPENSSL_hexstr2buf(refdata[recnum].key, NULL);       /* custom allocation site */
      |            ^~~~~~~~~~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:285:5: warning: implicit declaration of function ‘memcpy’ [-Wimplicit-function-declaration]
  285 |     memcpy(rec->data, pt, ptlen);
      |     ^~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:10:1: note: include ‘<string.h>’ or provide a declaration of ‘memcpy’
    9 | #include "../openssl.h"
  +++ |+#include <string.h>
   10 | 
./benchmarks/openssl/double_free_4/openssl_df_4.c:285:5: warning: incompatible implicit declaration of built-in function ‘memcpy’ [-Wbuiltin-declaration-mismatch]
  285 |     memcpy(rec->data, pt, ptlen);
      |     ^~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:285:5: note: include ‘<string.h>’ or provide a declaration of ‘memcpy’
./benchmarks/openssl/double_free_4/openssl_df_4.c: In function ‘test_tls13_encryption’:
./benchmarks/openssl/double_free_4/openssl_df_4.c:307:30: warning: implicit declaration of function ‘EVP_aes_128_gcm’; did you mean ‘OBJ_aes_128_gcm’? [-Wimplicit-function-declaration]
  307 |     const EVP_CIPHER *ciph = EVP_aes_128_gcm();
      |                              ^~~~~~~~~~~~~~~
      |                              OBJ_aes_128_gcm
./benchmarks/openssl/double_free_4/openssl_df_4.c:307:30: warning: initialization of ‘const EVP_CIPHER *’ {aka ‘const struct evp_cipher_st *’} from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
./benchmarks/openssl/double_free_4/openssl_df_4.c:313:11: warning: implicit declaration of function ‘SSL_CTX_new’ [-Wimplicit-function-declaration]
  313 |     ctx = SSL_CTX_new(TLS_method());
      |           ^~~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:313:23: warning: implicit declaration of function ‘TLS_method’ [-Wimplicit-function-declaration]
  313 |     ctx = SSL_CTX_new(TLS_method());
      |                       ^~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:313:9: warning: assignment to ‘SSL_CTX *’ {aka ‘struct ssl_ctx_st *’} from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
  313 |     ctx = SSL_CTX_new(TLS_method());
      |         ^
./benchmarks/openssl/double_free_4/openssl_df_4.c:319:9: warning: implicit declaration of function ‘SSL_new’ [-Wimplicit-function-declaration]
  319 |     s = SSL_new(ctx);
      |         ^~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:319:7: warning: assignment to ‘SSL *’ {aka ‘struct ssl_st *’} from ‘int’ makes pointer from integer without a cast [-Wint-conversion]
  319 |     s = SSL_new(ctx);
      |       ^
./benchmarks/openssl/double_free_4/openssl_df_4.c:325:25: warning: implicit declaration of function ‘OSSL_NELEM’ [-Wimplicit-function-declaration]
  325 |     for (ctr = 0; ctr < OSSL_NELEM(refdata); ctr++) {
      |                         ^~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:330:17: warning: implicit declaration of function ‘EVP_CIPHER_iv_length’ [-Wimplicit-function-declaration]
  330 |         ivlen = EVP_CIPHER_iv_length(ciph);
      |                 ^~~~~~~~~~~~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:332:26: warning: implicit declaration of function ‘RECORD_LAYER_get_read_sequence’ [-Wimplicit-function-declaration]
  332 |                          RECORD_LAYER_get_read_sequence(&s->rlayer))) {
      |                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:332:26: warning: passing argument 6 of ‘load_record’ makes pointer from integer without a cast [-Wint-conversion]
  332 |                          RECORD_LAYER_get_read_sequence(&s->rlayer))) {
      |                          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      |                          |
      |                          int
./benchmarks/openssl/double_free_4/openssl_df_4.c:266:72: note: expected ‘unsigned char *’ but argument is of type ‘int’
  266 |                        unsigned char *iv, size_t ivlen, unsigned char *seq)
      |                                                         ~~~~~~~~~~~~~~~^~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:337:9: warning: incompatible implicit declaration of built-in function ‘memcpy’ [-Wbuiltin-declaration-mismatch]
  337 |         memcpy(RECORD_LAYER_get_write_sequence(&s->rlayer),
      |         ^~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:337:9: note: include ‘<string.h>’ or provide a declaration of ‘memcpy’
./benchmarks/openssl/double_free_4/openssl_df_4.c:337:16: warning: implicit declaration of function ‘RECORD_LAYER_get_write_sequence’ [-Wimplicit-function-declaration]
  337 |         memcpy(RECORD_LAYER_get_write_sequence(&s->rlayer),
      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:337:16: warning: passing argument 1 of ‘memcpy’ makes pointer from integer without a cast [-Wint-conversion]
  337 |         memcpy(RECORD_LAYER_get_write_sequence(&s->rlayer),
      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      |                |
      |                int
./benchmarks/openssl/double_free_4/openssl_df_4.c:337:16: note: expected ‘void *’ but argument is of type ‘int’
./benchmarks/openssl/double_free_4/openssl_df_4.c:338:16: warning: passing argument 2 of ‘memcpy’ makes pointer from integer without a cast [-Wint-conversion]
  338 |                RECORD_LAYER_get_read_sequence(&s->rlayer), SEQ_NUM_SIZE);
      |                ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~
      |                |
      |                int
./benchmarks/openssl/double_free_4/openssl_df_4.c:338:16: note: expected ‘const void *’ but argument is of type ‘int’
./benchmarks/openssl/double_free_4/openssl_df_4.c:341:13: warning: implicit declaration of function ‘EVP_CipherInit_ex’ [-Wimplicit-function-declaration]
  341 |         if (EVP_CipherInit_ex(s->enc_write_ctx, ciph, NULL, key, NULL, 1) <= 0
      |             ^~~~~~~~~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:349:13: warning: implicit declaration of function ‘tls13_enc’ [-Wimplicit-function-declaration]
  349 |         if (tls13_enc(s, &rec, 1, 1) != 1) {
      |             ^~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:354:14: warning: implicit declaration of function ‘test_record’ [-Wimplicit-function-declaration]
  354 |         if (!test_record(&rec, ctr, 1)) {
      |              ^~~~~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:386:5: warning: implicit declaration of function ‘SSL_free’ [-Wimplicit-function-declaration]
  386 |     SSL_free(s);
      |     ^~~~~~~~
./benchmarks/openssl/double_free_4/openssl_df_4.c:387:5: warning: implicit declaration of function ‘SSL_CTX_free’ [-Wimplicit-function-declaration]
  387 |     SSL_CTX_free(ctx);
      |     ^~~~~~~~~~~~

Time variable                                   usr           sys          wall           GGC
 phase setup                        :   0.00 (  0%)   0.00 (  0%)   0.00 (  0%)  1298k ( 37%)
 phase parsing                      :   0.08 ( 89%)   0.03 (100%)   0.11 ( 92%)  2035k ( 58%)
 phase opt and generate             :   0.01 ( 11%)   0.00 (  0%)   0.01 (  8%)   171k (  5%)
 callgraph ipa passes               :   0.01 ( 11%)   0.00 (  0%)   0.01 (  8%)    93k (  3%)
 lto stream compression             :   0.01 ( 11%)   0.00 (  0%)   0.00 (  0%)     0  (  0%)
 ipa free lang data                 :   0.00 (  0%)   0.00 (  0%)   0.01 (  8%)  9016  (  0%)
 preprocessing                      :   0.01 ( 11%)   0.01 ( 33%)   0.00 (  0%)  1097k ( 31%)
 lexical analysis                   :   0.00 (  0%)   0.00 (  0%)   0.02 ( 17%)     0  (  0%)
 parser (global)                    :   0.00 (  0%)   0.01 ( 33%)   0.01 (  8%)   710k ( 20%)
 parser struct body                 :   0.01 ( 11%)   0.00 (  0%)   0.01 (  8%)   109k (  3%)
 parser function body               :   0.06 ( 67%)   0.01 ( 33%)   0.07 ( 58%)   110k (  3%)
 TOTAL                              :   0.09          0.03          0.12         3515k
./benchmarks/openssl/double_free_4/openssl_df_4.c: In function ‘test_tls13_encryption’:
./benchmarks/openssl/double_free_4/openssl_df_4.c:383:5: warning: double-‘free’ of ‘key’ [CWE-415] [-Wanalyzer-double-free]
  383 |     OPENSSL_free(key);
      |     ^
  ‘main’: events 1-2
    |
    |  392 | int main()
    |      |     ^
    |      |     |
    |      |     (1) entry to ‘main’
    |  393 | {
    |  394 |         test_tls13_encryption();
    |      |         ~
    |      |         |
    |      |         (2) calling ‘test_tls13_encryption’ from ‘main’
    |
    +--> ‘test_tls13_encryption’: events 3-6
           |
           |  301 | static int test_tls13_encryption(void)
           |      |            ^
           |      |            |
           |      |            (3) entry to ‘test_tls13_encryption’
           |......
           |  314 |     if (ctx == NULL) {
           |      |        ~    
           |      |        |
           |      |        (4) following ‘false’ branch...
           |......
           |  319 |     s = SSL_new(ctx);
           |      |         ~   
           |      |         |
           |      |         (5) ...to here
           |  320 |     if (s == NULL) {
           |      |        ~    
           |      |        |
           |      |        (6) following ‘false’ branch...
           |
         ‘test_tls13_encryption’: event 7
           |
           |lto1:
           | (7): ...to here
           |
         ‘test_tls13_encryption’: events 8-10
           |
           |  325 |     for (ctr = 0; ctr < OSSL_NELEM(refdata); ctr++) {
           |      |                       ^
           |      |                       |
           |      |                       (8) following ‘true’ branch...
           |......
           |  330 |         ivlen = EVP_CIPHER_iv_length(ciph);
           |      |                 ~      
           |      |                 |
           |      |                 (9) ...to here
           |  331 |         if (!load_record(&rec, ctr, &key, s->read_iv, ivlen,
           |      |              ~         
           |      |              |
           |      |              (10) calling ‘load_record’ from ‘test_tls13_encryption’
           |
           +--> ‘load_record’: events 11-16
                  |
                  |  265 | static int load_record(SSL3_RECORD *rec, size_t recnum, unsigned char **key,
                  |      |            ^
                  |      |            |
                  |      |            (11) entry to ‘load_record’
                  |......
                  |  271 |     *key = OPENSSL_hexstr2buf(refdata[recnum].key, NULL);       /* custom allocation site */
                  |      |            ~
                  |      |            |
                  |      |            (12) allocated here
                  |......
                  |  276 |     if (*key == NULL || ivtmp == NULL || sq == NULL || pt == NULL)
                  |      |        ~                      ~
                  |      |        |                      |
                  |      |        |                      (15) ...to here
                  |      |        (13) assuming ‘key’ is non-NULL
                  |      |        (14) following ‘false’ branch...
                  |......
                  |  294 |     OPENSSL_free(*key);
                  |      |     ~       
                  |      |     |
                  |      |     (16) first ‘free’ here
                  |
           <------+
           |
         ‘test_tls13_encryption’: events 17-20
           |
           |  331 |         if (!load_record(&rec, ctr, &key, s->read_iv, ivlen,
           |      |            ~ ^
           |      |            | |
           |      |            | (17) returning to ‘test_tls13_encryption’ from ‘load_record’
           |      |            (18) following ‘true’ branch...
           |  332 |                          RECORD_LAYER_get_read_sequence(&s->rlayer))) {
           |  333 |             fprintf(stderr, "Failed loading key into EVP_CIPHER_CTX\n");
           |      |             ~ 
           |      |             |
           |      |             (19) ...to here
           |......
           |  383 |     OPENSSL_free(key);
           |      |     ~         
           |      |     |
           |      |     (20) second ‘free’ here; first ‘free’ was at (16)
           |

Time variable                                   usr           sys          wall           GGC
 phase setup                        :   0.00 (  0%)   0.00 (  0%)   0.00 (  0%)  2157k ( 92%)
 phase opt and generate             :   0.07 ( 88%)   0.01 (100%)   0.09 (100%)   109k (  5%)
 phase stream out                   :   0.01 ( 12%)   0.00 (  0%)   0.00 (  0%)     0  (  0%)
 garbage collection                 :   0.01 ( 12%)   0.00 (  0%)   0.00 (  0%)     0  (  0%)
 ipa reference                      :   0.00 (  0%)   0.00 (  0%)   0.01 ( 11%)     0  (  0%)
 analyzer: processing worklist      :   0.06 ( 75%)   0.01 (100%)   0.07 ( 78%)   528  (  0%)
 analyzer: emitting diagnostics     :   0.01 ( 13%)   0.00 (  0%)   0.01 ( 11%)   384  (  0%)
 TOTAL                              :   0.08          0.01          0.09         2343k

Time variable                                   usr           sys          wall           GGC
 phase setup                        :   0.00 (  0%)   0.00 (  0%)   0.01 ( 33%)  2157k ( 79%)
 phase opt and generate             :   0.01 (100%)   0.01 (100%)   0.02 ( 67%)   513k ( 19%)
 callgraph functions expansion      :   0.01 (100%)   0.01 (100%)   0.02 ( 67%)   375k ( 14%)
 trivially dead code                :   0.01 (100%)   0.00 (  0%)   0.00 (  0%)     0  (  0%)
 dominator optimization             :   0.00 (  0%)   0.01 (100%)   0.00 (  0%)    13k (  0%)
 LRA non-specific                   :   0.00 (  0%)   0.00 (  0%)   0.01 ( 33%)  4296  (  0%)
 rest of compilation                :   0.00 (  0%)   0.00 (  0%)   0.01 ( 33%)    10k (  0%)
 TOTAL                              :   0.01          0.01          0.03         2746k
/usr/bin/ld: /tmp/ccneGHBl.ltrans0.ltrans.o: in function `test_tls13_encryption':
<artificial>:(.text+0x14f): undefined reference to `EVP_aes_128_gcm'
/usr/bin/ld: <artificial>:(.text+0x165): undefined reference to `TLS_method'
/usr/bin/ld: <artificial>:(.text+0x171): undefined reference to `SSL_CTX_new'
/usr/bin/ld: <artificial>:(.text+0x191): undefined reference to `SSL_new'
/usr/bin/ld: <artificial>:(.text+0x1be): undefined reference to `OSSL_NELEM'
/usr/bin/ld: <artificial>:(.text+0x1d7): undefined reference to `EVP_CIPHER_iv_length'
/usr/bin/ld: <artificial>:(.text+0x1e7): undefined reference to `RECORD_LAYER_get_read_sequence'
/usr/bin/ld: <artificial>:(.text+0x21d): undefined reference to `RECORD_LAYER_get_read_sequence'
/usr/bin/ld: <artificial>:(.text+0x22c): undefined reference to `RECORD_LAYER_get_write_sequence'
/usr/bin/ld: <artificial>:(.text+0x274): undefined reference to `EVP_CipherInit_ex'
/usr/bin/ld: <artificial>:(.text+0x2a1): undefined reference to `EVP_CipherInit_ex'
/usr/bin/ld: <artificial>:(.text+0x2c5): undefined reference to `tls13_enc'
/usr/bin/ld: <artificial>:(.text+0x2e5): undefined reference to `test_record'
/usr/bin/ld: <artificial>:(.text+0x30b): undefined reference to `tls13_enc'
/usr/bin/ld: <artificial>:(.text+0x32b): undefined reference to `test_record'
/usr/bin/ld: <artificial>:(.text+0x3a3): undefined reference to `SSL_free'
/usr/bin/ld: <artificial>:(.text+0x3b2): undefined reference to `SSL_CTX_free'
collect2: error: ld returned 1 exit status
