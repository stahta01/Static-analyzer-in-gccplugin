./benchmarks/openssl/double_free_2/openssl_df_2.c: In function ‘tls_construct_cke_rsa’:
./benchmarks/openssl/double_free_2/openssl_df_2.c:75:9: warning: implicit declaration of function ‘RAND_bytes’ [-Wimplicit-function-declaration]
   75 |     if (RAND_bytes(pms + 2, (int)(pmslen - 2)) <= 0) {
      |         ^~~~~~~~~~
./benchmarks/openssl/double_free_2/openssl_df_2.c:83:10: warning: implicit declaration of function ‘ssl_log_rsa_client_key_exchange’ [-Wimplicit-function-declaration]
   83 |     if (!ssl_log_rsa_client_key_exchange(s, encdata, enclen, pms, pmslen))
      |          ^~~~~~~~~~~~~~~~~~~~~~~~~~~~~~~

Time variable                                   usr           sys          wall           GGC
 phase setup                        :   0.00 (  0%)   0.00 (  0%)   0.00 (  0%)  1298k ( 39%)
 phase parsing                      :   0.07 ( 88%)   0.02 (100%)   0.09 ( 90%)  1898k ( 56%)
 phase opt and generate             :   0.01 ( 12%)   0.00 (  0%)   0.01 ( 10%)   160k (  5%)
 callgraph optimization             :   0.00 (  0%)   0.00 (  0%)   0.01 ( 10%)     0  (  0%)
 callgraph ipa passes               :   0.01 ( 12%)   0.00 (  0%)   0.01 ( 10%)    49k (  1%)
 preprocessing                      :   0.01 ( 12%)   0.00 (  0%)   0.04 ( 40%)  1081k ( 32%)
 lexical analysis                   :   0.00 (  0%)   0.00 (  0%)   0.01 ( 10%)     0  (  0%)
 parser (global)                    :   0.02 ( 25%)   0.02 (100%)   0.01 ( 10%)   676k ( 20%)
 parser struct body                 :   0.01 ( 13%)   0.00 (  0%)   0.00 (  0%)   102k (  3%)
 parser function body               :   0.03 ( 38%)   0.00 (  0%)   0.03 ( 30%)    29k (  1%)
 tree CCP                           :   0.01 ( 12%)   0.00 (  0%)   0.00 (  0%)   752  (  0%)
 TOTAL                              :   0.08          0.02          0.10         3367k
In function ‘tls_construct_client_key_exchange’:
./benchmarks/openssl/double_free_2/openssl_df_2.c:103:5: warning: double-‘free’ of ‘_2->tmp.pms’ [CWE-415] [-Wanalyzer-double-free]
  103 |     OPENSSL_clear_free(s->s3->tmp.pms, s->s3->tmp.pmslen);  /* double-free */
      |     ^
  ‘main’: events 1-2
    |
    |  108 | int main()
    |      |     ^
    |      |     |
    |      |     (1) entry to ‘main’
    |......
    |  111 |     if(!ssl3_new(&s))
    |      |         ~
    |      |         |
    |      |         (2) calling ‘ssl3_new’ from ‘main’
    |
    +--> ‘ssl3_new’: events 3-5
           |
           |   36 | int ssl3_new(SSL *s)
           |      |     ^
           |      |     |
           |      |     (3) entry to ‘ssl3_new’
           |......
           |   40 |     if ((s3 = OPENSSL_zalloc(sizeof(*s3))) == NULL)
           |      |        ~
           |      |        |
           |      |        (4) following ‘false’ branch (when ‘s3_5’ is non-NULL)...
           |   41 |         goto err;
           |   42 |     s->s3 = s3;
           |      |           ~
           |      |           |
           |      |           (5) ...to here
           |
    <------+
    |
  ‘main’: events 6-9
    |
    |  111 |     if(!ssl3_new(&s))
    |      |       ~ ^
    |      |       | |
    |      |       | (6) returning to ‘main’ from ‘ssl3_new’
    |      |       (7) following ‘false’ branch...
    |......
    |  114 |     if(!tls_construct_client_key_exchange(&s, NULL))
    |      |         ~
    |      |         |
    |      |         (8) ...to here
    |      |         (9) calling ‘tls_construct_client_key_exchange’ from ‘main’
    |
    +--> ‘tls_construct_client_key_exchange’: events 10-11
           |
           |   93 | int tls_construct_client_key_exchange(SSL *s, WPACKET *pkt)
           |      |     ^
           |      |     |
           |      |     (10) entry to ‘tls_construct_client_key_exchange’
           |......
           |   98 |     if (!tls_construct_cke_rsa(s, pkt, &al))
           |      |          ~
           |      |          |
           |      |          (11) calling ‘tls_construct_cke_rsa’ from ‘tls_construct_client_key_exchange’
           |
           +--> ‘tls_construct_cke_rsa’: events 12-17
                  |
                  |   59 | static int tls_construct_cke_rsa(SSL *s, WPACKET *pkt, int *al)
                  |      |            ^
                  |      |            |
                  |      |            (12) entry to ‘tls_construct_cke_rsa’
                  |......
                  |   68 |     if (pms == NULL) {
                  |      |        ~    
                  |      |        |
                  |      |        (13) following ‘false’ branch (when ‘pms_18’ is non-NULL)...
                  |......
                  |   72 |     pms[0] = s->client_version >> 8;
                  |      |               ~
                  |      |               |
                  |      |               (14) ...to here
                  |......
                  |   75 |     if (RAND_bytes(pms + 2, (int)(pmslen - 2)) <= 0) {
                  |      |        ~    
                  |      |        |
                  |      |        (15) following ‘true’ branch...
                  |   76 |         goto err;
                  |      |         ~   
                  |      |         |
                  |      |         (16) ...to here
                  |......
                  |   88 |     OPENSSL_clear_free(s->s3->tmp.pms, s->s3->tmp.pmslen);  /* freed */
                  |      |     ~       
                  |      |     |
                  |      |     (17) first ‘free’ here
                  |
           <------+
           |
         ‘tls_construct_client_key_exchange’: events 18-21
           |
           |   98 |     if (!tls_construct_cke_rsa(s, pkt, &al))
           |      |        ~ ^
           |      |        | |
           |      |        | (18) returning to ‘tls_construct_client_key_exchange’ from ‘tls_construct_cke_rsa’
           |      |        (19) following ‘true’ branch...
           |   99 |         goto err;
           |      |         ~ 
           |      |         |
           |      |         (20) ...to here
           |......
           |  103 |     OPENSSL_clear_free(s->s3->tmp.pms, s->s3->tmp.pmslen);  /* double-free */
           |      |     ~     
           |      |     |
           |      |     (21) second ‘free’ here; first ‘free’ was at (17)
           |
In function ‘tls_construct_cke_rsa’:
./benchmarks/openssl/double_free_2/openssl_df_2.c:88:5: warning: leak of ‘pms_18’ [CWE-401] [-Wanalyzer-malloc-leak]
   88 |     OPENSSL_clear_free(s->s3->tmp.pms, s->s3->tmp.pmslen);  /* freed */
      |     ^
  ‘tls_construct_cke_rsa’: events 1-7
    |
    |   67 |     pms = OPENSSL_malloc(pmslen);       /* allocation site */
    |      |           ^
    |      |           |
    |      |           (1) allocated here
    |   68 |     if (pms == NULL) {
    |      |        ~   
    |      |        |
    |      |        (2) assuming ‘pms_18’ is non-NULL
    |      |        (3) following ‘false’ branch (when ‘pms_18’ is non-NULL)...
    |......
    |   72 |     pms[0] = s->client_version >> 8;
    |      |               ~
    |      |               |
    |      |               (4) ...to here
    |......
    |   75 |     if (RAND_bytes(pms + 2, (int)(pmslen - 2)) <= 0) {
    |      |        ~   
    |      |        |
    |      |        (5) following ‘true’ branch...
    |   76 |         goto err;
    |      |         ~  
    |      |         |
    |      |         (6) ...to here
    |......
    |   88 |     OPENSSL_clear_free(s->s3->tmp.pms, s->s3->tmp.pmslen);  /* freed */
    |      |     ~      
    |      |     |
    |      |     (7) ‘pms_18’ leaks here; was allocated at (1)
    |

Time variable                                   usr           sys          wall           GGC
 phase setup                        :   0.00 (  0%)   0.00 (  0%)   0.00 (  0%)  2157k ( 96%)
 phase opt and generate             :   0.01 (100%)   0.01 (100%)   0.02 (100%)    62k (  3%)
 analyzer                           :   0.01 (100%)   0.00 (  0%)   0.00 (  0%)     0  (  0%)
 analyzer: processing worklist      :   0.00 (  0%)   0.00 (  0%)   0.01 ( 50%)   576  (  0%)
 analyzer: emitting diagnostics     :   0.00 (  0%)   0.01 (100%)   0.01 ( 50%)     0  (  0%)
 TOTAL                              :   0.01          0.01          0.02         2257k

Time variable                                   usr           sys          wall           GGC
 phase setup                        :   0.00 (  0%)   0.00 (  0%)   0.00 (  0%)  2157k ( 85%)
 phase opt and generate             :   0.03 (100%)   0.00 (  0%)   0.03 (100%)   341k ( 13%)
 callgraph functions expansion      :   0.03 (100%)   0.00 (  0%)   0.02 ( 67%)   270k ( 11%)
 ipa points-to                      :   0.00 (  0%)   0.00 (  0%)   0.01 ( 33%)  3320  (  0%)
 tree conservative DCE              :   0.01 ( 33%)   0.00 (  0%)   0.00 (  0%)     0  (  0%)
 dominance computation              :   0.00 (  0%)   0.00 (  0%)   0.01 ( 33%)     0  (  0%)
 combiner                           :   0.01 ( 33%)   0.00 (  0%)   0.00 (  0%)  3360  (  0%)
 integrated RA                      :   0.00 (  0%)   0.00 (  0%)   0.01 ( 33%)   123k (  5%)
 initialize rtl                     :   0.01 ( 33%)   0.00 (  0%)   0.00 (  0%)    12k (  0%)
 TOTAL                              :   0.03          0.00          0.03         2534k
/usr/bin/ld: /tmp/ccPlS8tP.ltrans0.ltrans.o: in function `tls_construct_cke_rsa':
<artificial>:(.text+0x84): undefined reference to `RAND_bytes'
/usr/bin/ld: <artificial>:(.text+0xbb): undefined reference to `ssl_log_rsa_client_key_exchange'
collect2: error: ld returned 1 exit status
