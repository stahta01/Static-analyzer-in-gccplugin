
;; Function main (main, funcdef_no=24, decl_uid=3650, cgraph_uid=25, symbol_order=25)

Removing basic block 3
Merging blocks 2 and 4
;; 1 loops found
;;
;; Loop 0
;;  header 0, latch 1
;;  depth 0, outer -1
;;  nodes: 0 1 2
;; 2 succs { 1 }
int main ()
{
  int D.3653;

  <bb 2> :
  test_tls13_encryption ();
  D.3653 = 0;
  return D.3653;

}



;; Function test_tls13_encryption (test_tls13_encryption, funcdef_no=23, decl_uid=3603, cgraph_uid=24, symbol_order=24)

Merging blocks 23 and 24
Merging blocks 23 and 25
;; 2 loops found
;;
;; Loop 0
;;  header 0, latch 1
;;  depth 0, outer -1
;;  nodes: 0 1 2 3 4 5 6 7 8 9 10 11 12 13 14 15 16 17 18 19 20 21 22 23
;;
;; Loop 1
;;  header 21, latch 20
;;  depth 1, outer 0
;;  nodes: 21 20 18 16 14 12 10 9 7
;; 2 succs { 3 4 }
;; 3 succs { 23 }
;; 4 succs { 5 6 }
;; 5 succs { 23 }
;; 6 succs { 21 }
;; 7 succs { 8 9 }
;; 8 succs { 23 }
;; 9 succs { 11 10 }
;; 10 succs { 11 12 }
;; 11 succs { 23 }
;; 12 succs { 13 14 }
;; 13 succs { 23 }
;; 14 succs { 15 16 }
;; 15 succs { 23 }
;; 16 succs { 17 18 }
;; 17 succs { 23 }
;; 18 succs { 19 20 }
;; 19 succs { 23 }
;; 20 succs { 21 }
;; 21 succs { 7 22 }
;; 22 succs { 23 }
;; 23 succs { 1 }
int test_tls13_encryption ()
{
  long unsigned int D.3673;
  size_t ctr;
  size_t ivlen;
  int ret;
  const struct EVP_CIPHER * ciph;
  unsigned char * seq;
  unsigned char * iv;
  unsigned char * key;
  struct SSL3_RECORD rec;
  struct SSL * s;
  struct SSL_CTX * ctx;
  int D.3672;

  <bb 2> :
  ctx = 0B;
  s = 0B;
  key = 0B;
  iv = 0B;
  seq = 0B;
  _1 = EVP_aes_128_gcm ();
  _2 = (long int) _1;
  ciph = (const struct EVP_CIPHER *) _2;
  ret = 0;
  rec.data = 0B;
  _3 = TLS_method ();
  _4 = SSL_CTX_new (_3);
  _5 = (long int) _4;
  ctx = (struct SSL_CTX *) _5;
  if (ctx == 0B)
    goto <bb 3>; [INV]
  else
    goto <bb 4>; [INV]

  <bb 3> :
  stderr.0_6 = stderr;
  __builtin_fwrite ("Failed creating SSL_CTX\n", 1, 24, stderr.0_6);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 4> :
  _7 = SSL_new (ctx);
  _8 = (long int) _7;
  s = (struct SSL *) _8;
  if (s == 0B)
    goto <bb 5>; [INV]
  else
    goto <bb 6>; [INV]

  <bb 5> :
  stderr.1_9 = stderr;
  __builtin_fwrite ("Failed creating SSL\n", 1, 20, stderr.1_9);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 6> :
  ctr = 0;
  goto <bb 21>; [INV]

  <bb 7> :
  _10 = EVP_CIPHER_iv_length (ciph);
  ivlen = (size_t) _10;
  _11 = &s->rlayer;
  _12 = RECORD_LAYER_get_read_sequence (_11);
  _13 = (long int) _12;
  _14 = (unsigned char *) _13;
  _15 = &s->read_iv;
  _16 = load_record (&rec, ctr, &key, _15, ivlen, _14);
  if (_16 == 0)
    goto <bb 8>; [INV]
  else
    goto <bb 9>; [INV]

  <bb 8> :
  stderr.2_17 = stderr;
  __builtin_fwrite ("Failed loading key into EVP_CIPHER_CTX\n", 1, 39, stderr.2_17);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 9> :
  _18 = &s->rlayer;
  _19 = RECORD_LAYER_get_read_sequence (_18);
  _20 = (long int) _19;
  _21 = (const void *) _20;
  _22 = &s->rlayer;
  _23 = RECORD_LAYER_get_write_sequence (_22);
  _24 = (long int) _23;
  _25 = (void *) _24;
  D.3673 = MEM <long unsigned int> [(char * {ref-all})_21];
  MEM <long unsigned int> [(char * {ref-all})_25] = D.3673;
  _26 = &s->read_iv;
  _27 = &s->write_iv;
  memcpy (_27, _26, ivlen);
  key.3_28 = key;
  _29 = s->enc_write_ctx;
  _30 = EVP_CipherInit_ex (_29, ciph, 0B, key.3_28, 0B, 1);
  if (_30 <= 0)
    goto <bb 11>; [INV]
  else
    goto <bb 10>; [INV]

  <bb 10> :
  key.4_31 = key;
  _32 = s->enc_read_ctx;
  _33 = EVP_CipherInit_ex (_32, ciph, 0B, key.4_31, 0B, 0);
  if (_33 <= 0)
    goto <bb 11>; [INV]
  else
    goto <bb 12>; [INV]

  <bb 11> :
  stderr.5_34 = stderr;
  __builtin_fwrite ("Failed loading key into EVP_CIPHER_CTX\n", 1, 39, stderr.5_34);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 12> :
  _35 = tls13_enc (s, &rec, 1, 1);
  if (_35 != 1)
    goto <bb 13>; [INV]
  else
    goto <bb 14>; [INV]

  <bb 13> :
  stderr.6_36 = stderr;
  __builtin_fwrite ("Failed to encrypt record\n", 1, 25, stderr.6_36);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 14> :
  _37 = test_record (&rec, ctr, 1);
  if (_37 == 0)
    goto <bb 15>; [INV]
  else
    goto <bb 16>; [INV]

  <bb 15> :
  stderr.7_38 = stderr;
  __builtin_fwrite ("Record encryption test failed\n", 1, 30, stderr.7_38);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 16> :
  _39 = tls13_enc (s, &rec, 1, 0);
  if (_39 != 1)
    goto <bb 17>; [INV]
  else
    goto <bb 18>; [INV]

  <bb 17> :
  stderr.8_40 = stderr;
  __builtin_fwrite ("Failed to decrypt record\n", 1, 25, stderr.8_40);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 18> :
  _41 = test_record (&rec, ctr, 0);
  if (_41 == 0)
    goto <bb 19>; [INV]
  else
    goto <bb 20>; [INV]

  <bb 19> :
  stderr.9_42 = stderr;
  __builtin_fwrite ("Record decryption test failed\n", 1, 30, stderr.9_42);
  // predicted unlikely by goto predictor.
  goto <bb 23>; [INV]

  <bb 20> :
  _43 = rec.data;
  free (_43);
  key.10_44 = key;
  free (key.10_44);
  free (iv);
  free (seq);
  rec.data = 0B;
  key = 0B;
  iv = 0B;
  seq = 0B;
  ctr = ctr + 1;

  <bb 21> :
  _45 = OSSL_NELEM (&refdata);
  _46 = (long unsigned int) _45;
  if (ctr < _46)
    goto <bb 7>; [INV]
  else
    goto <bb 22>; [INV]

  <bb 22> :
  ret = 1;

  <bb 23> :
err:
  _47 = rec.data;
  free (_47);
  key.11_48 = key;
  free (key.11_48);
  free (iv);
  free (seq);
  SSL_free (s);
  SSL_CTX_free (ctx);
  D.3672 = ret;
  rec = {CLOBBER};
  key = {CLOBBER};
  return D.3672;

}



;; Function load_record (load_record, funcdef_no=22, decl_uid=3593, cgraph_uid=23, symbol_order=23)

;; 1 loops found
;;
;; Loop 0
;;  header 0, latch 1
;;  depth 0, outer -1
;;  nodes: 0 1 2 3 4 5 6 7 8 9 10
;; 2 succs { 5 3 }
;; 3 succs { 5 4 }
;; 4 succs { 5 6 }
;; 5 succs { 9 }
;; 6 succs { 7 8 }
;; 7 succs { 9 }
;; 8 succs { 10 }
;; 9 succs { 10 }
;; 10 succs { 1 }
int load_record (struct SSL3_RECORD * rec, size_t recnum, unsigned char * * key, unsigned char * iv, size_t ivlen, unsigned char * seq)
{
  long unsigned int D.3683;
  long int ptlen;
  unsigned char * ivtmp;
  unsigned char * sq;
  unsigned char * pt;
  int D.3682;

  <bb 2> :
  pt = 0B;
  sq = 0B;
  ivtmp = 0B;
  _1 = refdata[recnum].key;
  _2 = strdup (_1);
  *key = _2;
  _3 = refdata[recnum].iv;
  ivtmp = strdup (_3);
  _4 = refdata[recnum].seq;
  sq = strdup (_4);
  _5 = refdata[recnum].plaintext;
  pt = strdup (_5);
  _6 = *key;
  if (_6 == 0B)
    goto <bb 5>; [INV]
  else
    goto <bb 3>; [INV]

  <bb 3> :
  _7 = ivtmp == 0B;
  _8 = sq == 0B;
  _9 = _7 | _8;
  if (_9 != 0)
    goto <bb 5>; [INV]
  else
    goto <bb 4>; [INV]

  <bb 4> :
  if (pt == 0B)
    goto <bb 5>; [INV]
  else
    goto <bb 6>; [INV]

  <bb 5> :
  // predicted unlikely by goto predictor.
  goto <bb 9>; [INV]

  <bb 6> :
  _10 = ptlen + 16;
  _11 = (long unsigned int) _10;
  _12 = malloc (_11);
  rec->input = _12;
  _13 = rec->input;
  rec->data = _13;
  _14 = rec->data;
  if (_14 == 0B)
    goto <bb 7>; [INV]
  else
    goto <bb 8>; [INV]

  <bb 7> :
  // predicted unlikely by goto predictor.
  goto <bb 9>; [INV]

  <bb 8> :
  ptlen.12_15 = (long unsigned int) ptlen;
  rec->length = ptlen.12_15;
  ptlen.13_16 = (long unsigned int) ptlen;
  _17 = rec->data;
  memcpy (_17, pt, ptlen.13_16);
  free (pt);
  D.3683 = MEM <long unsigned int> [(char * {ref-all})sq];
  MEM <long unsigned int> [(char * {ref-all})seq] = D.3683;
  free (sq);
  memcpy (iv, ivtmp, ivlen);
  free (ivtmp);
  D.3682 = 1;
  goto <bb 10>; [INV]

  <bb 9> :
err:
  _18 = *key;
  free (_18);
  free (ivtmp);
  free (sq);
  free (pt);
  D.3682 = 0;

  <bb 10> :
  return D.3682;

}


